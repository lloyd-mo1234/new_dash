<!-- Regression Table Panel - Saved for later use -->
<div class="trading-panel regression-table">
    <div class="regression-inputs">
        <div class="form-group">
            <label for="regInstrument1">Instrument 1</label>
            <input type="text" id="regInstrument1" placeholder="e.g., aud.5y">
        </div>
        <div class="form-group">
            <label for="regInstrument2">Instrument 2</label>
            <input type="text" id="regInstrument2" placeholder="e.g., aud.10y">
        </div>
        <div class="form-group">
            <label for="regInstrument3">Instrument 3</label>
            <input type="text" id="regInstrument3" placeholder="e.g., aud.2y">
        </div>
    </div>
    
    <button type="button" class="btn btn-primary" onclick="updateRegressionTable()">Update Regression</button>
    
    <div class="regression-table-container">
        <table class="regression-table-data" id="regressionTable">
            <thead>
                <tr>
                    <th rowspan="2">Metric</th>
                    <th colspan="3">Instrument 1</th>
                    <th colspan="3">Instrument 2</th>
                    <th colspan="3">Instrument 3</th>
                </tr>
                <tr>
                    <th>1M</th>
                    <th>2M</th>
                    <th>3M</th>
                    <th>1M</th>
                    <th>2M</th>
                    <th>3M</th>
                    <th>1M</th>
                    <th>2M</th>
                    <th>3M</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>RÂ²</td>
                    <td id="r2_1_1">--</td>
                    <td id="r2_1_2">--</td>
                    <td id="r2_1_3">--</td>
                    <td id="r2_2_1">--</td>
                    <td id="r2_2_2">--</td>
                    <td id="r2_2_3">--</td>
                    <td id="r2_3_1">--</td>
                    <td id="r2_3_2">--</td>
                    <td id="r2_3_3">--</td>
                </tr>
                <tr>
                    <td>Beta</td>
                    <td id="beta_1_1">--</td>
                    <td id="beta_1_2">--</td>
                    <td id="beta_1_3">--</td>
                    <td id="beta_2_1">--</td>
                    <td id="beta_2_2">--</td>
                    <td id="beta_2_3">--</td>
                    <td id="beta_3_1">--</td>
                    <td id="beta_3_2">--</td>
                    <td id="beta_3_3">--</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Associated CSS -->
<style>
.regression-inputs {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 20px;
}

.regression-table-container {
    overflow-x: auto;
}

.regression-table-data {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
}

.regression-table-data th,
.regression-table-data td {
    border: 1px solid #444;
    padding: 8px;
    text-align: center;
}

.regression-table-data th {
    background: #1e1e1e;
    color: #00d4ff;
}

.regression-table-data td {
    background: #2d2d2d;
}
</style>

<!-- Associated JavaScript Functions -->
<script>
function updateRegressionTable() {
    const instruments = [
        document.getElementById('regInstrument1').value,
        document.getElementById('regInstrument2').value,
        document.getElementById('regInstrument3').value
    ].filter(inst => inst.trim() !== '');
    
    if (instruments.length === 0) {
        alert('Please enter at least one instrument');
        return;
    }
    
    // Get current portfolio instrument (for now, use first trade's instrument)
    fetch('/get_trades')
    .then(response => response.json())
    .then(data => {
        if (data.success && Object.keys(data.trades).length > 0) {
            const firstTrade = Object.values(data.trades)[0];
            const yInstrument = firstTrade.instrument_details;
            
            return fetch('/run_trade_regression', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    y_instrument: yInstrument,
                    x_instruments: instruments
                })
            });
        } else {
            throw new Error('No trades available for regression');
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            updateRegressionDisplay(data.results, instruments);
        } else {
            alert('Error running regression: ' + (data.error || 'Unknown error'));
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error running regression: ' + error.message);
    });
}

function updateRegressionDisplay(results, instruments) {
    instruments.forEach((instrument, instIndex) => {
        [1, 2, 3].forEach(months => {
            const result = results[instrument];
            if (result && result[months] && result[months].regression) {
                const reg = result[months].regression;
                document.getElementById(`r2_${instIndex + 1}_${months}`).textContent = 
                    reg.r_squared ? reg.r_squared.toFixed(3) : '--';
                document.getElementById(`beta_${instIndex + 1}_${months}`).textContent = 
                    reg.beta ? reg.beta.toFixed(3) : '--';
            } else {
                document.getElementById(`r2_${instIndex + 1}_${months}`).textContent = '--';
                document.getElementById(`beta_${instIndex + 1}_${months}`).textContent = '--';
            }
        });
    });
}
</script>
